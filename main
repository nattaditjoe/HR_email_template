import React, { useMemo, useState } from "react";

// --- Minimal mock data (add all later) ---
const TEMPLATES = [
  {
    id: 1,
    stage: "Sourcing & First Contact",
    situation: "First Contact — Inviting Candidate from Search",
    tone: "Polite, warm, professional",
    tags: ["invite", "search", "first contact"],
    variables: ["Candidate Name", "Position", "Company Name", "Relevant Skill/Field"],
    en: `Subject: Opportunity with {{Company Name}} — {{Position}}

Dear {{Candidate Name}},

I came across your profile and was impressed by your experience in {{Relevant Skill/Field}}.

We currently have an opening for the position of {{Position}} at {{Company Name}}, and I believe your background could be a great fit.

Would you be open to discussing this opportunity further? If so, please let me know your availability or share your updated CV.

Best regards,
HR Team
{{Company Name}}`,
    th: `เรื่อง: โอกาสร่วมงานกับ {{Company Name}} — ตำแหน่ง {{Position}}

เรียนคุณ{{Candidate Name}},

ทางบริษัทได้เห็นประวัติของคุณและประทับใจในประสบการณ์ด้าน {{Relevant Skill/Field}}

ขณะนี้บริษัทมีตำแหน่ง {{Position}} เปิดรับอยู่ ซึ่งตรงกับความเชี่ยวชาญของคุณเป็นอย่างดี

หากคุณสนใจร่วมพูดคุยเพิ่มเติม รบกวนแจ้งช่วงเวลาที่สะดวก หรือส่งประวัติอัปเดตกลับมาได้เลยนะคะ

ขอบคุณค่ะ
ทีมงานสรรหา
{{Company Name}}`,
  },
  {
    id: 2,
    stage: "Sourcing & First Contact",
    situation: "Follow-up — Candidate Didn’t Reply",
    tone: "Gentle reminder",
    tags: ["follow-up", "reminder"],
    variables: ["Candidate Name", "Position", "Company Name"],
    en: `Subject: Following up on our previous message — {{Position}}

Dear {{Candidate Name}},

I hope you’re doing well. I wanted to follow up on my previous email about the {{Position}} opportunity at {{Company Name}}.

We’d be happy to share more details if you’re interested. Please let me know if you’re open to a quick chat — or feel free to decline.

Best regards,
HR Team
{{Company Name}}`,
    th: `เรื่อง: ติดตามโอกาสงานตำแหน่ง {{Position}}

เรียนคุณ{{Candidate Name}},

หวังว่าคุณจะสบายดีนะคะ ขอติดตามอีเมลก่อนหน้านี้เกี่ยวกับตำแหน่ง {{Position}} ที่ {{Company Name}}

หากสนใจ ทางเรายินดีให้ข้อมูลเพิ่มเติมได้เลยค่ะ แต่หากตอนนี้ยังไม่สะดวกก็ไม่เป็นไร รบกวนแจ้งกลับได้ค่ะ

ด้วยความนับถือ,
ทีมงานสรรหา
{{Company Name}}`,
  },
  {
    id: 3,
    stage: "Application & Screening",
    situation: "Application Received — Acknowledgment",
    tone: "Warm, appreciative",
    tags: ["acknowledge", "application"],
    variables: ["Candidate Name", "Position", "Company Name"],
    en: `Subject: Your Application Has Been Received — {{Position}}

Dear {{Candidate Name}},

Thank you for applying for the {{Position}} position at {{Company Name}}.
We’ve received your application and our recruitment team is reviewing it.
We’ll contact you once your qualifications have been assessed, or if we need additional information.

Best regards,
HR Team
{{Company Name}}`,
    th: `เรื่อง: ได้รับใบสมัครของคุณเรียบร้อยแล้ว — ตำแหน่ง {{Position}}

เรียนคุณ{{Candidate Name}},

ขอบคุณที่ส่งใบสมัครสำหรับตำแหน่ง {{Position}} กับ {{Company Name}}
ทีมสรรหากำลังตรวจสอบข้อมูลของคุณ และจะติดต่อกลับเมื่อมีความคืบหน้า หรือหากต้องการข้อมูลเพิ่มเติมค่ะ

ด้วยความนับถือ,
ทีมงานสรรหา
{{Company Name}}`,
  },
  {
    id: 4,
    stage: "Interview Process",
    situation: "Interview Invitation (Online/Onsite)",
    tone: "Clear, welcoming",
    tags: ["interview", "invite"],
    variables: ["Candidate Name", "Position", "Date", "Time", "Venue or Meeting Link"],
    en: `Subject: Interview Invitation — {{Position}}

Dear {{Candidate Name}},

We’re pleased to invite you to an interview for the {{Position}} role.

Date: {{Date}}
Time: {{Time}}
Location / Link: {{Venue or Meeting Link}}

Please confirm your availability by replying to this email.

Best regards,
HR Team`,
    th: `เรื่อง: เชิญเข้าร่วมสัมภาษณ์ — ตำแหน่ง {{Position}}

เรียนคุณ{{Candidate Name}},

บริษัทมีความยินดีเชิญคุณเข้าสัมภาษณ์สำหรับตำแหน่ง {{Position}}

วัน/เวลา: {{Date}} {{Time}}
สถานที่ / ลิงก์: {{Venue or Meeting Link}}

กรุณายืนยันการเข้าร่วมโดยตอบกลับอีเมลนี้ค่ะ

ด้วยความนับถือ,
ทีมงานสรรหา`,
  },
  {
    id: 5,
    stage: "Interview Process",
    situation: "Candidate No-Show (Follow-up)",
    tone: "Polite but firm",
    tags: ["no-show", "interview"],
    variables: ["Candidate Name", "Position", "Company Name", "Date"],
    en: `Subject: Follow-up Regarding Your Interview on {{Date}}

Dear {{Candidate Name}},

We noticed you were unable to attend your interview scheduled on {{Date}} for the {{Position}} position.
We hope everything is alright. If there was an unexpected issue, please let us know so we can assist or reschedule if appropriate.

Best regards,
HR Team
{{Company Name}}`,
    th: `เรื่อง: ติดตามการสัมภาษณ์ในวันที่ {{Date}}

เรียนคุณ{{Candidate Name}},

ทางบริษัทสังเกตว่าท่านไม่ได้เข้าร่วมการสัมภาษณ์ในวันที่ {{Date}} สำหรับตำแหน่ง {{Position}}
หากมีเหตุสุดวิสัยหรือต้องการเลื่อนวันสัมภาษณ์ กรุณาแจ้งกลับเพื่อให้ทีมงานประสานงานได้ค่ะ

ด้วยความนับถือ,
ทีมงานสรรหา
{{Company Name}}`,
  },
  {
    id: 6,
    stage: "Offer & Onboarding",
    situation: "Job Offer",
    tone: "Formal, enthusiastic",
    tags: ["offer", "hire"],
    variables: ["Candidate Name", "Position", "Company Name", "Date"],
    en: `Subject: Job Offer from {{Company Name}} — {{Position}}

Dear {{Candidate Name}},

Congratulations! We’re delighted to offer you the position of {{Position}} at {{Company Name}}.
Please find the details attached. Kindly confirm your acceptance by {{Date}}.

Best regards,
HR Team
{{Company Name}}`,
    th: `เรื่อง: ข้อเสนอการจ้างงานจาก {{Company Name}} — ตำแหน่ง {{Position}}

เรียนคุณ{{Candidate Name}},

ขอแสดงความยินดี! ทางบริษัทมีความยินดีเสนอให้คุณเข้าร่วมงานในตำแหน่ง {{Position}}
รายละเอียดแนบมาพร้อมอีเมลนี้ กรุณายืนยันการตอบรับภายในวันที่ {{Date}}

ด้วยความนับถือ,
ทีมงานสรรหา
{{Company Name}}`,
  },
];

const stages = Array.from(new Set(TEMPLATES.map(t => t.stage)));
const tones = Array.from(new Set(TEMPLATES.map(t => t.tone)));

function replaceVars(text, values) {
  let out = text;
  Object.entries(values).forEach(([key, val]) => {
    const re = new RegExp(`{{\\s*${key}\\s*}}`, "g");
    out = out.replace(re, val || `{{${key}}}`);
  });
  return out;
}

export default function HRTemplateLibrary() {
  const [query, setQuery] = useState("");
  const [stage, setStage] = useState("All");
  const [tone, setTone] = useState("All");
  const [lang, setLang] = useState("en");
  const [active, setActive] = useState(TEMPLATES[0]);
  const [values, setValues] = useState({
    "Candidate Name": "Alex",
    "Position": "Marketing Manager",
    "Company Name": "Acme Co.",
    "Relevant Skill/Field": "digital marketing",
    "Date": "12 Nov 2025",
    "Time": "10:00 AM",
    "Venue or Meeting Link": "Google Meet",
  });

  const filtered = useMemo(() => {
    return TEMPLATES.filter(t =>
      (stage === "All" || t.stage === stage) &&
      (tone === "All" || t.tone === tone) &&
      (query.trim() === "" ||
        t.situation.toLowerCase().includes(query.toLowerCase()) ||
        t.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))
      )
    );
  }, [query, stage, tone]);

  const rendered = useMemo(() => replaceVars(active?.[lang] || "", values), [active, lang, values]);

  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(rendered);
      alert("Copied to clipboard");
    } catch {
      alert("Copy failed. Select and copy manually.");
    }
  };

  return (
    <div className="min-h-screen bg-neutral-50 text-neutral-900 p-6">
      <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Header */}
        <header className="lg:col-span-3">
          <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
            <div>
              <h1 className="text-3xl font-bold">Universal HR Email Template Library</h1>
              <p className="text-sm text-neutral-600 mt-1">Bilingual • Modern formal • Plug-and-send</p>
            </div>
            <div className="flex items-center gap-2">
              <label className="text-sm">Language</label>
              <select value={lang} onChange={e => setLang(e.target.value)} className="border rounded-lg px-3 py-2">
                <option value="en">English</option>
                <option value="th">ไทย</option>
              </select>
            </div>
          </div>

          <div className="mt-4 grid grid-cols-1 md:grid-cols-4 gap-3">
            <input
              className="border rounded-xl px-4 py-3 md:col-span-2"
              placeholder="Search situations, e.g., no-show, interview, offer"
              value={query}
              onChange={e => setQuery(e.target.value)}
            />
            <select className="border rounded-xl px-4 py-3" value={stage} onChange={e => setStage(e.target.value)}>
              <option>All</option>
              {stages.map(s => <option key={s}>{s}</option>)}
            </select>
            <select className="border rounded-xl px-4 py-3" value={tone} onChange={e => setTone(e.target.value)}>
              <option>All</option>
              {tones.map(s => <option key={s}>{s}</option>)}
            </select>
          </div>
        </header>

        {/* Left: List */}
        <aside className="lg:col-span-1 bg-white rounded-2xl shadow-sm border p-4">
          <h2 className="text-lg font-semibold mb-3">Templates</h2>
          <div className="space-y-2 max-h-[70vh] overflow-auto pr-1">
            {filtered.map(t => (
              <button
                key={t.id}
                onClick={() => setActive(t)}
                className={`w-full text-left p-3 rounded-xl border transition ${active?.id === t.id ? "bg-neutral-100 border-neutral-300" : "hover:bg-neutral-50"}`}
              >
                <div className="text-sm text-neutral-500">{t.stage}</div>
                <div className="font-medium">{t.situation}</div>
                <div className="text-xs text-neutral-500 mt-1">Tone: {t.tone}</div>
              </button>
            ))}
          </div>
        </aside>

        {/* Middle: Preview */}
        <main className="lg:col-span-2 bg-white rounded-2xl shadow-sm border p-4 flex flex-col gap-4">
          <div className="flex items-start justify-between gap-4">
            <div>
              <h2 className="text-xl font-semibold">Preview</h2>
              <p className="text-sm text-neutral-600">Live-rendered with your variables</p>
            </div>
            <div className="flex gap-2">
              <button onClick={handleCopy} className="px-4 py-2 rounded-xl bg-black text-white">Copy</button>
            </div>
          </div>
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            {/* Rendered */}
            <div className="border rounded-xl p-4 bg-neutral-50 whitespace-pre-wrap text-sm">
              {rendered}
            </div>
            {/* Variables */}
            <div className="border rounded-xl p-4">
              <h3 className="font-medium mb-2">Variables</h3>
              <div className="grid grid-cols-1 gap-3">
                {(active?.variables || []).map(v => (
                  <div key={v} className="flex flex-col">
                    <label className="text-xs text-neutral-600 mb-1">{v}</label>
                    <input
                      className="border rounded-lg px-3 py-2"
                      value={values[v] || ""}
                      onChange={e => setValues(prev => ({ ...prev, [v]: e.target.value }))}
                    />
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Raw template toggle */}
          <details className="mt-2">
            <summary className="cursor-pointer text-sm text-neutral-600">Show raw template with placeholders</summary>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-3">
              <textarea readOnly className="border rounded-xl p-3 h-56 text-sm" value={active?.en || ""} />
              <textarea readOnly className="border rounded-xl p-3 h-56 text-sm" value={active?.th || ""} />
            </div>
          </details>
        </main>
      </div>

      {/* Footer */}
      <footer className="max-w-7xl mx-auto mt-8 text-center text-xs text-neutral-500">
        © {new Date().getFullYear()} Universal HR Templates • Phase demo. Add your brand, auth, and CMS next.
      </footer>
    </div>
  );
}
